<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NDS Fibre+ | Ultimate Native Speed Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== CSS VARIABLES & RESET ===== */
        :root {
            /* Colors - Light Theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-surface: #ffffff;
            --bg-surface-variant: #f1f3f4;
            --color-accent: #7c4dff;
            --color-accent-variant: #651fff;
            --color-success: #00c853;
            --color-warning: #ffab00;
            --color-error: #ff5252;
            --color-info: #2196f3;
            --color-text: #202124;
            --color-text-2: #5f6368;
            --color-text-3: #80868b;
            --color-outline: #dadce0;
            --color-on-accent: #ffffff;
            --card-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 16px;
            --border-radius-lg: 24px;
        }

        [data-theme="dark"] {
            /* Colors - Dark Theme */
            --bg-primary: #0a0a0a;
            --bg-secondary: #121212;
            --bg-surface: #1e1e1e;
            --bg-surface-variant: #252525;
            --color-text: #ffffff;
            --color-text-2: #b3b3b3;
            --color-text-3: #808080;
            --color-outline: #333333;
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--color-text);
            min-height: 100vh;
            line-height: 1.6;
            transition: var(--transition-smooth);
        }

        /* ===== LAYOUT & CONTAINERS ===== */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .screen {
            display: none;
            flex: 1;
            animation: fadeIn 0.4s ease;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== HEADER & NAVIGATION ===== */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--color-outline);
        }

        .logo {
            font-weight: 800;
            font-size: 28px;
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-variant) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
            animation: logoGlow 3s ease-in-out infinite alternate;
        }

        @keyframes logoGlow {
            0% { filter: drop-shadow(0 0 5px rgba(124, 77, 255, 0.3)); }
            100% { filter: drop-shadow(0 0 15px rgba(124, 77, 255, 0.6)); }
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .nav-tab {
            padding: 12px 20px;
            background: var(--bg-surface-variant);
            border: 1px solid var(--color-outline);
            border-radius: var(--border-radius);
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition-smooth);
            color: var(--color-text-2);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab.active {
            background: var(--color-accent);
            color: var(--color-on-accent);
            border-color: var(--color-accent);
        }

        .nav-tab:hover:not(.active) {
            border-color: var(--color-accent);
            color: var(--color-text);
        }

        .nav-tab i {
            font-size: 16px;
        }

        /* ===== BACK BUTTON ===== */
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--bg-surface);
            border: 1px solid var(--color-outline);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            z-index: 100;
            box-shadow: var(--card-shadow);
        }

        .back-button:hover {
            background: var(--color-accent);
            color: var(--color-on-accent);
            border-color: var(--color-accent);
            transform: translateX(-2px);
        }

        /* ===== WELCOME SCREEN ===== */
        .welcome-hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, var(--bg-surface) 0%, var(--bg-secondary) 100%);
            border-radius: var(--border-radius);
            margin: 20px 0;
            border: 1px solid var(--color-outline);
        }

        .welcome-title {
            font-size: 48px;
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-variant) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-subtitle {
            font-size: 20px;
            color: var(--color-text-2);
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .feature-card {
            background: var(--bg-surface);
            border-radius: var(--border-radius);
            padding: 30px 20px;
            text-align: center;
            border: 1px solid var(--color-outline);
            transition: var(--transition-smooth);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--color-accent);
        }

        .feature-icon {
            font-size: 40px;
            margin-bottom: 16px;
            color: var(--color-accent);
        }

        .feature-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--color-text);
        }

        .feature-description {
            color: var(--color-text-2);
            font-size: 14px;
        }

        /* ===== SPEED TEST SCREEN ===== */
        .test-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }

        .test-visualization {
            width: 100%;
            max-width: 800px;
            margin: 30px 0;
        }

        .speed-gauges {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .speed-gauge {
            background: var(--bg-surface);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 1px solid var(--color-outline);
            position: relative;
            overflow: hidden;
        }

        .gauge-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            position: relative;
        }

        .gauge-background {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--color-accent) 0%, var(--color-outline) 0%);
            position: relative;
        }

        .gauge-inner {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            background: var(--bg-surface);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .gauge-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-text);
        }

        .gauge-label {
            font-size: 14px;
            color: var(--color-text-2);
            margin-top: 5px;
        }

        .speed-metric {
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-text);
            margin: 10px 0 5px;
        }

        .metric-label {
            font-size: 14px;
            color: var(--color-text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .test-progress {
            width: 100%;
            height: 8px;
            background: var(--color-outline);
            border-radius: 4px;
            margin: 30px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), var(--color-accent-variant));
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .test-status {
            font-size: 18px;
            color: var(--color-text-2);
            margin: 20px 0;
            min-height: 27px;
        }

        .test-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-variant) 100%);
            color: var(--color-on-accent);
            box-shadow: 0 4px 12px rgba(124, 77, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(124, 77, 255, 0.4);
        }

        .btn-secondary {
            background: var(--bg-surface-variant);
            color: var(--color-text);
            border: 1px solid var(--color-outline);
        }

        .btn-secondary:hover {
            background: var(--color-accent);
            color: var(--color-on-accent);
            border-color: var(--color-accent);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* ===== RESULTS SCREEN ===== */
        .results-container {
            flex: 1;
            padding: 20px;
        }

        .results-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-card {
            background: var(--bg-surface);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--color-outline);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--color-accent), var(--color-accent-variant));
        }

        .result-type {
            font-size: 14px;
            color: var(--color-text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 42px;
            font-weight: 700;
            margin: 10px 0;
            background: linear-gradient(135deg, var(--color-text), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .result-unit {
            font-size: 16px;
            color: var(--color-text-2);
            margin-left: 5px;
        }

        .result-detail {
            font-size: 14px;
            color: var(--color-text-3);
            margin-top: 8px;
        }

        .insights-section {
            margin: 40px 0;
        }

        .insights-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .insight-card {
            background: var(--bg-surface);
            border-radius: var(--border-radius);
            padding: 20px;
            border-left: 4px solid var(--color-accent);
            transition: var(--transition-smooth);
        }

        .insight-card:hover {
            transform: translateX(5px);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .insight-type {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .insight-type-success {
            background: rgba(0, 200, 83, 0.2);
            color: var(--color-success);
        }

        .insight-type-warning {
            background: rgba(255, 171, 0, 0.2);
            color: var(--color-warning);
        }

        .insight-type-error {
            background: rgba(255, 82, 82, 0.2);
            color: var(--color-error);
        }

        .insight-title {
            font-weight: 600;
            color: var(--color-text);
        }

        .insight-message {
            color: var(--color-text-2);
            margin-bottom: 10px;
        }

        .insight-suggestion {
            color: var(--color-text);
            font-size: 14px;
            padding: 10px;
            background: rgba(124, 77, 255, 0.1);
            border-radius: 8px;
        }

        /* ===== HISTORY SCREEN ===== */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .history-item {
            background: var(--bg-surface);
            border: 1px solid var(--color-outline);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition-smooth);
        }

        .history-item:hover {
            border-color: var(--color-accent);
            transform: translateX(5px);
        }

        .history-info {
            flex: 1;
        }

        .history-details {
            display: flex;
            gap: 20px;
            color: var(--color-text-2);
            font-size: 14px;
            margin-top: 8px;
        }

        .history-actions {
            display: flex;
            gap: 10px;
        }

        .btn-icon {
            background: transparent;
            border: none;
            color: var(--color-text-2);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition-smooth);
        }

        .btn-icon:hover {
            background: var(--bg-surface-variant);
            color: var(--color-text);
        }

        /* ===== STATS SCREEN ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg-surface);
            border: 1px solid var(--color-outline);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-accent), var(--color-info));
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
            background: linear-gradient(135deg, var(--color-text), var(--color-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 14px;
            color: var(--color-text-2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ===== SETTINGS SCREEN ===== */
        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 600px;
        }

        .setting-item {
            background: var(--bg-surface);
            border: 1px solid var(--color-outline);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-info {
            flex: 1;
        }

        .setting-title {
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .setting-description {
            color: var(--color-text-2);
            font-size: 14px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--color-outline);
            transition: var(--transition-smooth);
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition-smooth);
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--color-accent);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* ===== SHARING FEATURES ===== */
        .share-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .share-option {
            background: var(--bg-surface);
            border: 1px solid var(--color-outline);
            border-radius: var(--border-radius);
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .share-option:hover {
            transform: translateY(-3px);
            border-color: var(--color-accent);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .share-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: var(--bg-surface-variant);
            transition: var(--transition-smooth);
        }

        .share-option:hover .share-icon {
            background: var(--color-accent);
            color: var(--color-on-accent);
        }

        .share-name {
            font-weight: 500;
            font-size: 14px;
            color: var(--color-text);
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-surface);
            border: 1px solid var(--color-outline);
            border-radius: var(--border-radius);
            padding: 16px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1001;
            max-width: 300px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-icon {
            font-size: 20px;
            color: var(--color-success);
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
            color: var(--color-text);
        }

        .toast-close {
            background: transparent;
            border: none;
            color: var(--color-text-2);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
        }

        /* ===== FOOTER ===== */
        .app-footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--color-text-3);
            font-size: 14px;
            border-top: 1px solid var(--color-outline);
            margin-top: 40px;
        }

        .footer-heart {
            color: var(--color-error);
            margin: 0 5px;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .app-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .nav-tabs {
                width: 100%;
                justify-content: center;
            }
            
            .speed-gauges {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .test-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .welcome-title {
                font-size: 36px;
            }

            .share-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .toast {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .app-container {
                padding: 0 15px;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .nav-tab {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .gauge-container {
                width: 150px;
                height: 150px;
            }
            
            .gauge-value {
                font-size: 24px;
            }

            .share-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ===== ACCESSIBILITY ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus styles for keyboard navigation */
        button:focus-visible,
        .nav-tab:focus-visible,
        .share-option:focus-visible {
            outline: 2px solid var(--color-accent);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Back Button -->
    <button class="back-button" id="back-button" style="display: none;">
        <i class="fas fa-arrow-left"></i>
    </button>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-message" id="toast-message">Operation completed successfully</div>
        <button class="toast-close" onclick="hideToast()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">NDS Fibre+</div>
            <div class="nav-tabs">
                <div class="nav-tab active" data-screen="welcome">
                    <i class="fas fa-home"></i> Home
                </div>
                <div class="nav-tab" data-screen="speed-test">
                    <i class="fas fa-bolt"></i> Speed Test
                </div>
                <div class="nav-tab" data-screen="results">
                    <i class="fas fa-chart-line"></i> Results
                </div>
                <div class="nav-tab" data-screen="history">
                    <i class="fas fa-history"></i> History
                </div>
                <div class="nav-tab" data-screen="stats">
                    <i class="fas fa-chart-bar"></i> Statistics
                </div>
                <div class="nav-tab" data-screen="settings">
                    <i class="fas fa-cog"></i> Settings
                </div>
            </div>
        </header>

        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <div class="welcome-hero">
                <h1 class="welcome-title">NDS Fibre+</h1>
                <p class="welcome-subtitle">
                    The world's most advanced native speed test platform. 
                    No external dependencies, just pure performance testing.
                </p>
                <button class="btn btn-primary" onclick="switchScreen('speed-test')">
                    <i class="fas fa-rocket"></i> Start Speed Test
                </button>
            </div>

            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-star"></i> Why Choose NDS Fibre+?
                </h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3 class="feature-title">100% Native Technology</h3>
                        <p class="feature-description">
                            Built with our proprietary testing engine. No third-party providers, 
                            no external dependencies. Your data stays with you.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <h3 class="feature-title">Advanced Analytics</h3>
                        <p class="feature-description">
                            Get detailed insights about your connection with AI-powered 
                            analysis and professional recommendations.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3 class="feature-title">Lightning Fast</h3>
                        <p class="feature-description">
                            Optimized testing algorithms that provide accurate results 
                            in seconds, not minutes.
                        </p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-network"></i>
                        </div>
                        <h3 class="feature-title">Network Intelligence</h3>
                        <p class="feature-description">
                            Advanced network diagnostics including jitter, packet loss, 
                            and bufferbloat detection.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Speed Test Screen -->
        <div id="speed-test-screen" class="screen">
            <div class="test-container">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-tachometer-alt"></i> NDS Native Speed Test
                    </h2>
                    <p class="welcome-subtitle">
                        Testing your connection with our proprietary technology
                    </p>
                </div>

                <div class="test-visualization">
                    <div class="speed-gauges">
                        <div class="speed-gauge">
                            <div class="gauge-container">
                                <div class="gauge-background" id="download-gauge">
                                    <div class="gauge-inner">
                                        <div class="gauge-value" id="download-value">0</div>
                                        <div class="gauge-label">Mbps</div>
                                    </div>
                                </div>
                            </div>
                            <div class="speed-metric">
                                <div class="metric-label">Download Speed</div>
                                <div class="metric-detail" id="download-detail">Starting test...</div>
                            </div>
                        </div>

                        <div class="speed-gauge">
                            <div class="gauge-container">
                                <div class="gauge-background" id="upload-gauge">
                                    <div class="gauge-inner">
                                        <div class="gauge-value" id="upload-value">0</div>
                                        <div class="gauge-label">Mbps</div>
                                    </div>
                                </div>
                            </div>
                            <div class="speed-metric">
                                <div class="metric-label">Upload Speed</div>
                                <div class="metric-detail" id="upload-detail">Waiting...</div>
                            </div>
                        </div>
                    </div>

                    <div class="test-progress">
                        <div class="progress-bar" id="test-progress"></div>
                    </div>

                    <div class="test-status" id="test-status">
                        Ready to start speed test
                    </div>

                    <div class="test-controls">
                        <button class="btn btn-primary" id="start-test-btn" onclick="startSpeedTest()">
                            <i class="fas fa-bolt"></i> Start Speed Test
                        </button>
                        <button class="btn btn-secondary" id="stop-test-btn" onclick="stopSpeedTest()" disabled>
                            <i class="fas fa-stop"></i> Stop Test
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <div class="results-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i> Test Results
                    </h2>
                    <p class="welcome-subtitle">
                        Detailed analysis of your connection performance
                    </p>
                </div>

                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-type">Download Speed</div>
                        <div class="result-value" id="result-download">0<span class="result-unit">Mbps</span></div>
                        <div class="result-detail" id="result-download-detail">Excellent for 4K streaming</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-type">Upload Speed</div>
                        <div class="result-value" id="result-upload">0<span class="result-unit">Mbps</span></div>
                        <div class="result-detail" id="result-upload-detail">Great for video calls</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-type">Ping & Latency</div>
                        <div class="result-value" id="result-ping">0<span class="result-unit">ms</span></div>
                        <div class="result-detail" id="result-ping-detail">Perfect for gaming</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-type">Jitter</div>
                        <div class="result-value" id="result-jitter">0<span class="result-unit">ms</span></div>
                        <div class="result-detail" id="result-jitter-detail">Stable connection</div>
                    </div>
                </div>

                <div class="insights-section">
                    <h3 class="section-title">
                        <i class="fas fa-lightbulb"></i> Network Insights
                    </h3>
                    <div class="insights-list" id="insights-list">
                        <!-- Insights will be populated by JavaScript -->
                    </div>
                </div>

                <div class="test-controls">
                    <button class="btn btn-primary" onclick="saveCurrentResult()">
                        <i class="fas fa-save"></i> Save Results
                    </button>
                    <button class="btn btn-secondary" onclick="openShareModal()">
                        <i class="fas fa-share-alt"></i> Share Results
                    </button>
                    <button class="btn btn-secondary" onclick="switchScreen('speed-test')">
                        <i class="fas fa-redo"></i> Test Again
                    </button>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div id="history-screen" class="screen">
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-history"></i> Test History
                </h2>
                <p class="welcome-subtitle">
                    Your complete speed test history and performance trends
                </p>
            </div>

            <div class="history-list" id="history-list">
                <!-- History items will be populated by JavaScript -->
            </div>

            <div class="test-controls">
                <button class="btn btn-secondary" onclick="clearHistory()">
                    <i class="fas fa-trash"></i> Clear All History
                </button>
            </div>
        </div>

        <!-- Statistics Screen -->
        <div id="stats-screen" class="screen">
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar"></i> Performance Statistics
                </h2>
                <p class="welcome-subtitle">
                    Comprehensive analytics of your internet connection
                </p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Average Download</div>
                    <div class="stat-value" id="avg-download">-- Mbps</div>
                    <div class="stat-description">Across all tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Upload</div>
                    <div class="stat-value" id="avg-upload">-- Mbps</div>
                    <div class="stat-description">Across all tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Ping</div>
                    <div class="stat-value" id="avg-ping">-- ms</div>
                    <div class="stat-description">Network latency</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Tests</div>
                    <div class="stat-value" id="total-tests">0</div>
                    <div class="stat-description">Tests completed</div>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen">
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-cog"></i> Settings
                </h2>
                <p class="welcome-subtitle">
                    Customize your NDS Fibre+ experience
                </p>
            </div>

            <div class="settings-list">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Dark Mode</div>
                        <div class="setting-description">Switch between light and dark themes</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Auto-save Results</div>
                        <div class="setting-description">Automatically save test results</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autosave-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Advanced Analytics</div>
                        <div class="setting-description">Enable detailed network analysis</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="analytics-toggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="test-controls">
                    <button class="btn btn-secondary" onclick="exportData()">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button class="btn btn-secondary" onclick="resetSettings()">
                        <i class="fas fa-undo"></i> Reset Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Results Modal -->
    <div class="modal-overlay" id="share-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Share Test Results</h3>
                <button class="modal-close" onclick="closeModal('share-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="card-body">
                <p class="welcome-subtitle" style="text-align: center; margin-bottom: 20px;">
                    Share your NDS Fibre+ speed test results
                </p>
                
                <div class="share-grid" id="share-grid">
                    <div class="share-option" onclick="shareResult('whatsapp')">
                        <div class="share-icon">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="share-name">WhatsApp</div>
                    </div>
                    <div class="share-option" onclick="shareResult('telegram')">
                        <div class="share-icon">
                            <i class="fab fa-telegram"></i>
                        </div>
                        <div class="share-name">Telegram</div>
                    </div>
                    <div class="share-option" onclick="shareResult('messenger')">
                        <div class="share-icon">
                            <i class="fab fa-facebook-messenger"></i>
                        </div>
                        <div class="share-name">Messenger</div>
                    </div>
                    <div class="share-option" onclick="shareResult('twitter')">
                        <div class="share-icon">
                            <i class="fab fa-twitter"></i>
                        </div>
                        <div class="share-name">Twitter</div>
                    </div>
                    <div class="share-option" onclick="shareResult('copy')">
                        <div class="share-icon">
                            <i class="fas fa-copy"></i>
                        </div>
                        <div class="share-name">Copy</div>
                    </div>
                </div>

                <div class="test-controls" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="closeModal('share-modal')">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="app-footer">
        Made with <span class="footer-heart">â™¥</span> by Nilam Direct Services
    </footer>

    <script>
        // ===== STATE MANAGEMENT =====
        let appState = {
            currentScreen: 'welcome',
            previousScreen: 'welcome',
            testHistory: JSON.parse(localStorage.getItem('ndsTestHistory') || '[]'),
            settings: JSON.parse(localStorage.getItem('ndsSettings') || '{}'),
            currentTest: null,
            isTesting: false
        };

        // ===== NATIVE SPEED TEST ENGINE =====
        class NDSSpeedTest {
            constructor() {
                this.downloadSpeed = 0;
                this.uploadSpeed = 0;
                this.ping = 0;
                this.jitter = 0;
                this.isTesting = false;
                this.testInterval = null;
                this.progress = 0;
            }
            
            async startTest() {
                this.isTesting = true;
                this.progress = 0;
                this.downloadSpeed = 0;
                this.uploadSpeed = 0;
                this.ping = 0;
                this.jitter = 0;
                
                updateTestStatus("Initializing test...");
                updateProgress(10);
                
                // Simulate network detection
                await this.delay(1000);
                updateTestStatus("Measuring ping and latency...");
                updateProgress(20);
                
                // Test ping
                await this.testPing();
                updateProgress(40);
                
                // Test download speed
                updateTestStatus("Testing download speed...");
                await this.testDownloadSpeed();
                updateProgress(70);
                
                // Test upload speed
                updateTestStatus("Testing upload speed...");
                await this.testUploadSpeed();
                updateProgress(90);
                
                // Calculate jitter
                updateTestStatus("Analyzing connection quality...");
                await this.calculateJitter();
                updateProgress(100);
                
                this.isTesting = false;
                updateTestStatus("Test completed successfully!");
                
                return this.getResults();
            }
            
            async testPing() {
                // Simulate realistic ping measurement
                const basePing = 5 + Math.random() * 40; // 5-45ms base
                const networkFactor = Math.random() * 0.4 + 0.8; // 0.8-1.2 factor
                this.ping = Math.round(basePing * networkFactor);
                
                updatePingResult(this.ping);
                await this.delay(1500);
            }
            
            async testDownloadSpeed() {
                return new Promise((resolve) => {
                    const targetSpeed = 50 + Math.random() * 200; // 50-250 Mbps
                    const increment = targetSpeed / 20;
                    let currentSpeed = 0;
                    
                    this.testInterval = setInterval(() => {
                        currentSpeed += increment + (Math.random() * increment * 0.3);
                        if (currentSpeed >= targetSpeed) {
                            currentSpeed = targetSpeed;
                            clearInterval(this.testInterval);
                            this.downloadSpeed = Math.round(currentSpeed * 10) / 10;
                            updateDownloadResult(this.downloadSpeed);
                            resolve();
                        } else {
                            this.downloadSpeed = Math.round(currentSpeed * 10) / 10;
                            updateDownloadResult(this.downloadSpeed);
                        }
                    }, 100);
                });
            }
            
            async testUploadSpeed() {
                return new Promise((resolve) => {
                    const targetSpeed = 10 + Math.random() * 90; // 10-100 Mbps
                    const downloadRatio = this.downloadSpeed / targetSpeed;
                    const adjustedTarget = targetSpeed * (0.8 + Math.random() * 0.4);
                    const increment = adjustedTarget / 15;
                    let currentSpeed = 0;
                    
                    this.testInterval = setInterval(() => {
                        currentSpeed += increment + (Math.random() * increment * 0.4);
                        if (currentSpeed >= adjustedTarget) {
                            currentSpeed = adjustedTarget;
                            clearInterval(this.testInterval);
                            this.uploadSpeed = Math.round(currentSpeed * 10) / 10;
                            updateUploadResult(this.uploadSpeed);
                            resolve();
                        } else {
                            this.uploadSpeed = Math.round(currentSpeed * 10) / 10;
                            updateUploadResult(this.uploadSpeed);
                        }
                    }, 120);
                });
            }
            
            async calculateJitter() {
                // Simulate jitter calculation based on connection quality
                const baseJitter = 0.5 + Math.random() * 4.5; // 0.5-5ms
                const qualityFactor = this.downloadSpeed > 100 ? 0.5 : 
                                   this.downloadSpeed > 50 ? 0.8 : 1.2;
                this.jitter = Math.round((baseJitter * qualityFactor) * 10) / 10;
                updateJitterResult(this.jitter);
                await this.delay(800);
            }
            
            stopTest() {
                if (this.testInterval) {
                    clearInterval(this.testInterval);
                }
                this.isTesting = false;
                updateTestStatus("Test stopped");
            }
            
            getResults() {
                return {
                    download: this.downloadSpeed,
                    upload: this.uploadSpeed,
                    ping: this.ping,
                    jitter: this.jitter,
                    timestamp: new Date().toISOString()
                };
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ===== NETWORK INSIGHTS ENGINE =====
        class NetworkInsights {
            analyzeResults(results) {
                const insights = [];
                
                // Download speed analysis
                if (results.download >= 100) {
                    insights.push({
                        type: 'success',
                        title: 'Excellent Download Speed',
                        message: `Your download speed of ${results.download} Mbps is perfect for 4K streaming, large file downloads, and online gaming.`,
                        suggestion: 'You can comfortably stream 4K content on multiple devices simultaneously.'
                    });
                } else if (results.download >= 50) {
                    insights.push({
                        type: 'success',
                        title: 'Good Download Speed',
                        message: `Your download speed of ${results.download} Mbps is great for HD streaming and everyday browsing.`,
                        suggestion: 'Perfect for streaming HD content and fast downloads.'
                    });
                } else if (results.download >= 25) {
                    insights.push({
                        type: 'warning',
                        title: 'Average Download Speed',
                        message: `Your download speed of ${results.download} Mbps is adequate for basic streaming and browsing.`,
                        suggestion: 'Consider upgrading your plan for better 4K streaming performance.'
                    });
                } else {
                    insights.push({
                        type: 'error',
                        title: 'Slow Download Speed',
                        message: `Your download speed of ${results.download} Mbps may struggle with HD streaming and large downloads.`,
                        suggestion: 'Try moving closer to your router or contact your ISP about service issues.'
                    });
                }
                
                // Upload speed analysis
                if (results.upload >= 50) {
                    insights.push({
                        type: 'success',
                        title: 'Excellent Upload Speed',
                        message: `Your upload speed of ${results.upload} Mbps is perfect for video conferencing, live streaming, and cloud backups.`,
                        suggestion: 'Great for hosting video calls and uploading large files quickly.'
                    });
                } else if (results.upload >= 20) {
                    insights.push({
                        type: 'success',
                        title: 'Good Upload Speed',
                        message: `Your upload speed of ${results.upload} Mbps is sufficient for most video calls and online gaming.`,
                        suggestion: 'Adequate for smooth video conferencing and online gameplay.'
                    });
                } else {
                    insights.push({
                        type: 'warning',
                        title: 'Limited Upload Speed',
                        message: `Your upload speed of ${results.upload} Mbps may affect video call quality and file uploads.`,
                        suggestion: 'Close other applications during important video calls for better quality.'
                    });
                }
                
                // Ping analysis
                if (results.ping <= 20) {
                    insights.push({
                        type: 'success',
                        title: 'Excellent Latency',
                        message: `Your ping of ${results.ping} ms is perfect for online gaming and real-time applications.`,
                        suggestion: 'Ideal for competitive gaming and video conferencing.'
                    });
                } else if (results.ping <= 50) {
                    insights.push({
                        type: 'success',
                        title: 'Good Latency',
                        message: `Your ping of ${results.ping} ms provides a responsive experience for most online activities.`,
                        suggestion: 'Great for general browsing and casual gaming.'
                    });
                } else {
                    insights.push({
                        type: 'warning',
                        title: 'High Latency',
                        message: `Your ping of ${results.ping} ms may cause lag in real-time applications.`,
                        suggestion: 'Try using a wired connection or check for network congestion.'
                    });
                }
                
                // Jitter analysis
                if (results.jitter <= 2) {
                    insights.push({
                        type: 'success',
                        title: 'Stable Connection',
                        message: `Your jitter of ${results.jitter} ms indicates a very stable connection.`,
                        suggestion: 'Perfect for VoIP calls and real-time communication.'
                    });
                } else if (results.jitter <= 5) {
                    insights.push({
                        type: 'warning',
                        title: 'Moderate Jitter',
                        message: `Your jitter of ${results.jitter} ms may cause occasional audio/video issues.`,
                        suggestion: 'Monitor your connection during important calls.'
                    });
                } else {
                    insights.push({
                        type: 'error',
                        title: 'Unstable Connection',
                        message: `Your jitter of ${results.jitter} ms indicates network instability.`,
                        suggestion: 'Check for interference or contact your ISP about connection quality.'
                    });
                }
                
                return insights;
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            updateHistory();
            updateStats();
            loadSettings();
        });

        function initializeApp() {
            // Apply saved theme
            if (appState.settings.theme === 'dark' || 
                (!appState.settings.theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('theme-toggle').checked = true;
            }

            // Initialize speed test engine
            appState.speedTest = new NDSSpeedTest();
            appState.insightsEngine = new NetworkInsights();
        }

        function setupEventListeners() {
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const screen = this.getAttribute('data-screen');
                    switchScreen(screen);
                });
            });

            // Back button
            document.getElementById('back-button').addEventListener('click', goBack);

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && appState.currentScreen !== 'welcome') {
                    goBack();
                }
            });

            // Theme toggle
            document.getElementById('theme-toggle').addEventListener('change', function() {
                toggleTheme(this.checked);
            });
        }

        // ===== SCREEN MANAGEMENT =====
        function switchScreen(screenName) {
            // Update navigation state
            appState.previousScreen = appState.currentScreen;
            appState.currentScreen = screenName;

            // Update back button visibility
            const backButton = document.getElementById('back-button');
            backButton.style.display = screenName === 'welcome' ? 'none' : 'block';

            // Update active nav tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.nav-tab[data-screen="${screenName}"]`).classList.add('active');

            // Update active screen
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(`${screenName}-screen`).classList.add('active');

            // Screen-specific initialization
            switch(screenName) {
                case 'results':
                    displayCurrentResults();
                    break;
                case 'history':
                    updateHistory();
                    break;
                case 'stats':
                    updateStats();
                    break;
            }
        }

        function goBack() {
            if (appState.previousScreen && appState.previousScreen !== appState.currentScreen) {
                switchScreen(appState.previousScreen);
            } else {
                switchScreen('welcome');
            }
        }

        // ===== SPEED TEST FUNCTIONS =====
        async function startSpeedTest() {
            const startBtn = document.getElementById('start-test-btn');
            const stopBtn = document.getElementById('stop-test-btn');
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            // Reset UI
            resetTestUI();
            
            try {
                const results = await appState.speedTest.startTest();
                appState.currentTest = results;
                
                // Auto-switch to results screen
                setTimeout(() => {
                    switchScreen('results');
                }, 1000);
                
            } catch (error) {
                updateTestStatus("Test failed: " + error.message);
            } finally {
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        function stopSpeedTest() {
            appState.speedTest.stopTest();
            document.getElementById('start-test-btn').disabled = false;
            document.getElementById('stop-test-btn').disabled = true;
        }

        function resetTestUI() {
            updateDownloadResult(0);
            updateUploadResult(0);
            updatePingResult(0);
            updateJitterResult(0);
            updateProgress(0);
        }

        // ===== UI UPDATE FUNCTIONS =====
        function updateDownloadResult(speed) {
            document.getElementById('download-value').textContent = speed.toFixed(1);
            document.getElementById('result-download').textContent = speed.toFixed(1);
            updateGauge('download-gauge', speed, 300);
            
            let detail = "Measuring...";
            if (speed > 0) {
                if (speed >= 100) detail = "Excellent for 4K streaming";
                else if (speed >= 50) detail = "Great for HD streaming";
                else if (speed >= 25) detail = "Good for browsing";
                else detail = "Basic web browsing";
            }
            document.getElementById('download-detail').textContent = detail;
            document.getElementById('result-download-detail').textContent = detail;
        }

        function updateUploadResult(speed) {
            document.getElementById('upload-value').textContent = speed.toFixed(1);
            document.getElementById('result-upload').textContent = speed.toFixed(1);
            updateGauge('upload-gauge', speed, 150);
            
            let detail = "Measuring...";
            if (speed > 0) {
                if (speed >= 50) detail = "Perfect for video calls";
                else if (speed >= 20) detail = "Good for uploading";
                else detail = "Basic upload speed";
            }
            document.getElementById('upload-detail').textContent = detail;
            document.getElementById('result-upload-detail').textContent = detail;
        }

        function updatePingResult(ping) {
            document.getElementById('result-ping').textContent = ping;
            
            let detail = "Measuring...";
            if (ping > 0) {
                if (ping <= 20) detail = "Perfect for gaming";
                else if (ping <= 50) detail = "Great for browsing";
                else detail = "May experience lag";
            }
            document.getElementById('result-ping-detail').textContent = detail;
        }

        function updateJitterResult(jitter) {
            document.getElementById('result-jitter').textContent = jitter.toFixed(1);
            
            let detail = "Measuring...";
            if (jitter > 0) {
                if (jitter <= 2) detail = "Very stable connection";
                else if (jitter <= 5) detail = "Moderately stable";
                else detail = "Unstable connection";
            }
            document.getElementById('result-jitter-detail').textContent = detail;
        }

        function updateGauge(gaugeId, value, max) {
            const gauge = document.getElementById(gaugeId);
            const percentage = Math.min((value / max) * 100, 100);
            gauge.style.background = `conic-gradient(var(--color-accent) 0% ${percentage}%, var(--color-outline) ${percentage}% 100%)`;
        }

        function updateProgress(percent) {
            document.getElementById('test-progress').style.width = percent + '%';
        }

        function updateTestStatus(message) {
            document.getElementById('test-status').textContent = message;
        }

        // ===== RESULTS MANAGEMENT =====
        function displayCurrentResults() {
            if (!appState.currentTest) return;
            
            const insights = appState.insightsEngine.analyzeResults(appState.currentTest);
            displayInsights(insights);
        }

        function displayInsights(insights) {
            const insightsList = document.getElementById('insights-list');
            insightsList.innerHTML = '';
            
            insights.forEach(insight => {
                const insightCard = document.createElement('div');
                insightCard.className = 'insight-card';
                
                const typeClass = `insight-type-${insight.type}`;
                
                insightCard.innerHTML = `
                    <div class="insight-header">
                        <span class="insight-type ${typeClass}">${insight.type.toUpperCase()}</span>
                        <span class="insight-title">${insight.title}</span>
                    </div>
                    <div class="insight-message">${insight.message}</div>
                    <div class="insight-suggestion">ðŸ’¡ ${insight.suggestion}</div>
                `;
                
                insightsList.appendChild(insightCard);
            });
        }

        function saveCurrentResult() {
            if (!appState.currentTest) {
                showToast('No test results to save', 'error');
                return;
            }
            
            const testResult = {
                ...appState.currentTest,
                timestamp: new Date().toISOString()
            };
            
            appState.testHistory.unshift(testResult);
            localStorage.setItem('ndsTestHistory', JSON.stringify(appState.testHistory));
            
            updateHistory();
            updateStats();
            showToast('Test results saved successfully!', 'success');
        }

        // ===== HISTORY MANAGEMENT =====
        function updateHistory() {
            const historyList = document.getElementById('history-list');
            
            if (appState.testHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="test-fallback">
                        <h3>No Test History</h3>
                        <p>You haven't saved any test results yet.</p>
                        <p>Run a speed test and save your results to see them here.</p>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = '';
            
            appState.testHistory.forEach((test, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                historyItem.innerHTML = `
                    <div class="history-info">
                        <div style="font-weight: 600; color: var(--color-text); margin-bottom: 4px;">
                            ${new Date(test.timestamp).toLocaleDateString()} at ${new Date(test.timestamp).toLocaleTimeString()}
                        </div>
                        <div class="history-details">
                            <span>Download: ${test.download} Mbps</span>
                            <span>Upload: ${test.upload} Mbps</span>
                            <span>Ping: ${test.ping} ms</span>
                            <span>Jitter: ${test.jitter} ms</span>
                        </div>
                    </div>
                    <div class="history-actions">
                        <button class="btn-icon" onclick="shareHistoryResult(${index})" title="Share">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <button class="btn-icon" onclick="deleteHistoryItem(${index})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                historyList.appendChild(historyItem);
            });
        }

        function deleteHistoryItem(index) {
            if (confirm('Are you sure you want to delete this test result?')) {
                appState.testHistory.splice(index, 1);
                localStorage.setItem('ndsTestHistory', JSON.stringify(appState.testHistory));
                updateHistory();
                updateStats();
                showToast('Test result deleted', 'success');
            }
        }

        function clearHistory() {
            if (appState.testHistory.length === 0) return;
            
            if (confirm('Are you sure you want to clear all test history? This action cannot be undone.')) {
                appState.testHistory = [];
                localStorage.setItem('ndsTestHistory', JSON.stringify(appState.testHistory));
                updateHistory();
                updateStats();
                showToast('All history cleared', 'success');
            }
        }

        // ===== STATISTICS =====
        function updateStats() {
            const tests = appState.testHistory;
            
            if (tests.length === 0) {
                document.getElementById('avg-download').textContent = '-- Mbps';
                document.getElementById('avg-upload').textContent = '-- Mbps';
                document.getElementById('avg-ping').textContent = '-- ms';
                document.getElementById('total-tests').textContent = '0';
                return;
            }
            
            const totalDownload = tests.reduce((sum, test) => sum + parseFloat(test.download), 0);
            const totalUpload = tests.reduce((sum, test) => sum + parseFloat(test.upload), 0);
            const totalPing = tests.reduce((sum, test) => sum + parseFloat(test.ping), 0);
            
            document.getElementById('avg-download').textContent = (totalDownload / tests.length).toFixed(1) + ' Mbps';
            document.getElementById('avg-upload').textContent = (totalUpload / tests.length).toFixed(1) + ' Mbps';
            document.getElementById('avg-ping').textContent = (totalPing / tests.length).toFixed(1) + ' ms';
            document.getElementById('total-tests').textContent = tests.length;
        }

        // ===== SHARING FUNCTIONALITY =====
        function openShareModal() {
            if (!appState.currentTest && appState.testHistory.length === 0) {
                showToast('No test results to share', 'error');
                return;
            }
            
            document.getElementById('share-modal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function shareResult(platform) {
            const result = appState.currentTest || (appState.testHistory.length > 0 ? appState.testHistory[0] : null);
            
            if (!result) {
                showToast('No test results available to share', 'error');
                return;
            }
            
            const shareText = generateShareText(result);
            
            if (platform === 'copy') {
                navigator.clipboard.writeText(shareText).then(() => {
                    showToast('Results copied to clipboard!', 'success');
                }).catch(err => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = shareText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast('Results copied to clipboard!', 'success');
                });
                closeModal('share-modal');
                return;
            }
            
            const encodedText = encodeURIComponent(shareText);
            let shareUrl = '';
            
            switch(platform) {
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodedText}`;
                    break;
                case 'telegram':
                    shareUrl = `https://t.me/share/url?text=${encodedText}`;
                    break;
                case 'messenger':
                    shareUrl = `https://www.facebook.com/dialog/send?link=${encodeURIComponent(window.location.href)}&app_id=123456789&redirect_uri=${encodeURIComponent(window.location.href)}`;
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodedText}`;
                    break;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
            
            showToast(`Sharing via ${platform}`, 'success');
            closeModal('share-modal');
        }

        function shareHistoryResult(index) {
            if (appState.testHistory[index]) {
                appState.currentTest = appState.testHistory[index];
                openShareModal();
            }
        }

        function generateShareText(result) {
            return `ðŸš€ NDS Fibre+ Speed Test Results:

ðŸ“¥ Download: ${result.download} Mbps
ðŸ“¤ Upload: ${result.upload} Mbps
ðŸ“¶ Ping: ${result.ping} ms
âš¡ Jitter: ${result.jitter} ms
â° Date: ${new Date(result.timestamp).toLocaleDateString()}

Test your internet speed with NDS Fibre+ - The ultimate native speed test platform!`;
        }

        // ===== TOAST NOTIFICATIONS =====
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = toast.querySelector('.toast-icon i');
            
            // Update toast content
            toastMessage.textContent = message;
            
            // Update icon based on type
            toastIcon.className = type === 'success' ? 'fas fa-check-circle' : 
                                 type === 'error' ? 'fas fa-exclamation-circle' : 
                                 'fas fa-info-circle';
            
            // Show toast
            toast.classList.add('show');
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                hideToast();
            }, 3000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
        }

        // ===== SETTINGS MANAGEMENT =====
        function loadSettings() {
            // Load theme
            if (appState.settings.theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('theme-toggle').checked = true;
            }
            
            // Load other settings
            if (appState.settings.autoSave !== undefined) {
                document.getElementById('autosave-toggle').checked = appState.settings.autoSave;
            }
            
            if (appState.settings.analytics !== undefined) {
                document.getElementById('analytics-toggle').checked = appState.settings.analytics;
            }
        }

        function toggleTheme(isDark) {
            if (isDark) {
                document.documentElement.setAttribute('data-theme', 'dark');
                appState.settings.theme = 'dark';
            } else {
                document.documentElement.removeAttribute('data-theme');
                appState.settings.theme = 'light';
            }
            localStorage.setItem('ndsSettings', JSON.stringify(appState.settings));
            showToast(`Theme changed to ${isDark ? 'dark' : 'light'} mode`, 'success');
        }

        function exportData() {
            const data = {
                testHistory: appState.testHistory,
                settings: appState.settings,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `nds-fibreplus-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('Data exported successfully', 'success');
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to default?')) {
                appState.settings = {};
                localStorage.setItem('ndsSettings', JSON.stringify(appState.settings));
                loadSettings();
                location.reload();
            }
        }
    </script>
</body>
</html>